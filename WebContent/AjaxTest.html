<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AJAX TEST</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
</head>

<body>
 <div id="mapid" style="width: 1000px; height: 600px;"></div>
 <br>
 <button onclick="loadData()">Load Data from Sever</button>
 <button onclick="removeLayerF(stateLayer)">Remove population layer</button>
 <button onclick="loadCountryData()">Add country layer</button>
 <button onclick="removeLayerF(countryLayer)">Remove country layer</button>
 
</body>
<!-- <script type="text/javascript" src="us-states.js"></script> -->

<script type="text/javascript">
var map = L.map('mapid').setView([33.986217,-81.056376], 5);
//The bug of the below line is fixed now
var streetLayerUrl = "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?"+
		"access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw";
var streetLayer = L.tileLayer(streetLayerUrl,{id: 'mapbox.streets', attribution: "MapBox"});
map.addLayer(streetLayer); //make this layer show by default

var googleMapLayer = L.tileLayer('http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}', {
	attribution: 'google'
	});

//http://colorbrewer2.org/#type=sequential&scheme=OrRd&n=5
function getColor(d) {
  return d > 1000 ? '#800026' :
         d > 500  ? '#BD0026' :
         d > 200  ? '#E31A1C' :
         d > 100  ? '#FC4E2A' :
         d > 50   ? '#FD8D3C' :
         d > 20   ? '#FEB24C' :
         d > 10   ? '#FED976' :
                    '#FFEDA0';
}

function setStyle(feature) {
  return {
      fillColor: getColor(feature.properties.density),
      fillOpacity: 0.8,
      weight: 1.0, //boarder
      color: 'white' //boarder
  };
}

function onEachFeature(feature, layer) {
    layer.on("click",zoomToFeature);
    
    if (feature.properties && feature.properties.name) {
        layer.bindPopup(feature.properties.name +"<br>"+
        		        feature.properties.density+"  people/mile<sup>2</sup>");
    }
}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}

// var baseLayers = {"MapBox": streetLayer,
//               "GoogleMap": googleMapLayer};

var layerControl = L.control.layers().addTo(map);
layerControl.addBaseLayer(streetLayer,"MapBox");
layerControl.addBaseLayer(googleMapLayer,"GoogleMap");

var stateLayer;//need to define as a global variable
function loadData() {
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {	     
	     var jsonText = this.responseText;
	     console.info(jsonText);
	     var statesData = JSON.parse(jsonText);
	     
	     stateLayer = L.geoJson(statesData, {
	    	    style: setStyle,
	    	    onEachFeature:onEachFeature
	    	});
	     map.addLayer(stateLayer);
	     layerControl.addOverlay(stateLayer,"State Population");
	    }
	  };
	  xhttp.open("GET", "data/us-states.txt", true);
	  xhttp.send();
	}
	
function removeLayer(){
	map.removeLayer(group);
	layerControl.removeLayer(group);
}

var countryLayer;
function loadCountryData(){
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {	     
	     var jsonText = this.responseText;
	     console.info(jsonText);
	     var jsonObj = JSON.parse(jsonText);
	     
	     countryLayer = L.geoJson(jsonObj);
	     map.addLayer(countryLayer);
	     layerControl.addOverlay(countryLayer,"Country");
	    }
	  };
	  xhttp.open("GET", "data/countries.geojson", true);
	  xhttp.send();
}

function removeCountryLayer(){
	map.removeLayer(countryLayer);
	layerControl.removeLayer(countryLayer);
}

function removeLayerF(layer){
	map.removeLayer(layer);
	layerControl.removeLayer(layer);
}
</script>

</html>

